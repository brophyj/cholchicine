{
  "hash": "2ea1c2a89960818450048668b5d661d3",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Colchicine\"\nauthor: \"Jay Brophy\"\ndate: 'November 16, 2024'\noutput:\n  html_document:\n    code_folding: hide\n    highlight: tango\n    theme: cerulean\n    toc: yes\n    toc_float: yes\n  pdf_document:\n    toc: yes\nlink-citations: true\nlinkcolor: red\nurlcolor: blue\n---\n\n::: {.cell .hidden}\n\n```{.r .cell-code .hidden}\nknitr::opts_chunk$set(echo = TRUE)\n\npackages <- c(\"ggplot2\", \"metafor\", \"meta\", \"tidyverse\", \"rjags\", \"rstan\", \"R2jags\", \"bayesmeta\", \"mcmcplots\")\ninvisible(lapply(packages, function(xxx) suppressMessages(require(xxx, character.only = TRUE, quietly=TRUE, warn.conflicts = FALSE))))\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: package 'meta' was built under R version 4.4.1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: package 'forestplot' was built under R version 4.4.1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: package 'abind' was built under R version 4.4.1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: package 'mvtnorm' was built under R version 4.4.1\n```\n\n\n:::\n:::\n\n\n\n\n# Useful functions\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n###Plot function\n#Please note that the upper_limit is manually defined to avoid ggplot to adjust it. You may have to change it.\n#You may have to tweak this\nmy.func1 <- function(my_sd=0.28,my_mean=log(0.7047),prob_harm=TRUE,upper_limit=2.5){\n  #Merely defines the subtitle of the figure\n  my_text=ifelse(prob_harm,\n  paste0(\"Probability OR>1 = \",round((1-pnorm(0,my_mean,my_sd))*100,2),\"%\"),\n  paste0(\"Probability OR<1 = \",round((pnorm(0,my_mean,my_sd))*100,2),\"%\"))\n  #Defines which area will be shaded\n  my_multiplier=ifelse(prob_harm,1,-1)\n  #Defines color\n  my_color=ifelse(prob_harm,\"blue\",\"red\")\n  #Actually builds the plot\n  my_plot<-ggplot(data = data.frame(x = c(-1.5, 1)), aes(x)) + #Empty plot\n  geom_vline(xintercept = my_mean, color=my_color)+ #Vertical line\n  geom_vline(xintercept = 0, linetype = 2)+ #Vertical Line\n  stat_function(fun = dnorm, n = 1000, args = list(mean = my_mean, sd = my_sd), linetype=1)+\n  geom_area(stat = \"function\", fun = dnorm, args = list(mean = my_mean, sd = my_sd),\n  fill = \"darkgray\", xlim = c(0,1*my_multiplier), alpha=0.9)+\n  theme_minimal()+ #You can change if you want\n  labs(x=\"log(OR)\", y=\"\", title=paste0(\"Data (likelihood function) for LoDoCo2 trial\"), subtitle=my_text)+\n  coord_cartesian(xlim=c(-1.5,1),ylim=c(0,upper_limit))\nreturn(my_plot)  #Returns plot\n}\n\n# function to analytically combine normal distributions\npost <- function(prior.mean, prior.sd, data.mean, data.sd){\n  wt.prior <- 1/ prior.sd^2\n  wt.data <- 1/ data.sd^2\n  post.mean <- (wt.prior  * prior.mean + wt.data * data.mean) / (wt.prior + wt.data)\n  post.sd <- sqrt((wt.prior + wt.data)^-1)\n  results <- list(post.mean, post.sd)\n  return(results)\n}\n\n\n###END###\n```\n:::\n\n\n\n# Colchicine in chronic CAD\n\nA randomized, controlled, double-blind trial comparing colchicine to placebo, in patients with chronic coronary disease (LoDoCo2) was  published in the [NEJM](https://www.nejm.org/doi/full/10.1056/NEJMoa2021372#article_Abstract). \nThe study reports a total of 5522 patients underwent randomization; 2762 were assigned to the colchicine\ngroup and 2760 to the placebo group. The median duration of follow-up\nwas 28.6 months. A primary end-point event occurred in 187 patients (6.8%) in\nthe colchicine group and in 264 patients (9.6%) in the placebo group (incidence,\n2.5 vs. 3.6 events per 100 person-years; hazard ratio, 0.69; 95% confidence interval\n[CI], 0.57 to 0.83; P<0.001).   \n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(fragility)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nRegistered S3 method overwritten by 'netmeta':\n  method          from\n  subset.pairwise meta\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"For the statistically significant primary result in colchicine group\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nFor the statistically significant primary result in colchicine group\n```\n\n\n:::\n\n```{.r .cell-code}\nfrag.study(e0 = 187, n0 = 2762, e1 = 264, n1 = 2760)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n___________________________________\nOriginal data:\n        event no event\ngroup 0   187     2575\ngroup 1   264     2496\nRange of event modification in group 0:\n  up to 187 events modified to be non-events;\n  up to 2575 non-events modified to be events\nRange of event modification in group 1:\n  up to 264 events modified to be non-events;\n  up to 2496 non-events modified to be events\n___________________________________\nSignificance level = 0.05\nNull hypothesis: OR = 1, RR = 1, RD = 0\np-value (two-sided):\n  0.000 based on Fisher's exact test\n  0.000 based on chi-squared test\n  0.000 based on odds ratio\n  0.000 based on relative risk\n  0.000 based on risk difference\n___________________________________\nFragility index (FI) and fragility quotient (FQ):\nBased on Fisher's exact test, FI = 36 (FQ = 0.7%)\n  for significance altered to non-significance,\n  achieved by inversing status of\n  36 non-events in group 0; or\n  32 non-events in group 0 and 4 events in group 1; or\n  33 non-events in group 0 and 3 events in group 1; or\n  34 non-events in group 0 and 2 events in group 1; or\n  35 non-events in group 0 and 1 event in group 1\nBased on chi-squared test, FI = 35 (FQ = 0.6%)\n  for significance altered to non-significance,\n  achieved by inversing status of\n  35 non-events in group 0; or\n  34 non-events in group 0 and 1 event in group 1\nBased on odds ratio, FI = 36 (FQ = 0.7%)\n  for significance altered to non-significance,\n  achieved by inversing status of\n  36 non-events in group 0; or\n  34 non-events in group 0 and 2 events in group 1; or\n  35 non-events in group 0 and 1 event in group 1\nBased on relative risk, FI = 36 (FQ = 0.7%)\n  for significance altered to non-significance,\n  achieved by inversing status of\n  36 non-events in group 0; or\n  34 non-events in group 0 and 2 events in group 1; or\n  35 non-events in group 0 and 1 event in group 1\nBased on risk difference, FI = 36 (FQ = 0.7%)\n  for significance altered to non-significance,\n  achieved by inversing status of\n  36 non-events in group 0; or\n  35 non-events in group 0 and 1 event in group 1\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"For the statistically significant result of CV death + MI in colchicine group\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nFor the statistically significant result of CV death + MI in colchicine group\n```\n\n\n:::\n\n```{.r .cell-code}\nfrag.study(e0 = 100, n0 = 2762, e1 = 138, n1 = 2760)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n___________________________________\nOriginal data:\n        event no event\ngroup 0   100     2662\ngroup 1   138     2622\nRange of event modification in group 0:\n  up to 100 events modified to be non-events;\n  up to 2662 non-events modified to be events\nRange of event modification in group 1:\n  up to 138 events modified to be non-events;\n  up to 2622 non-events modified to be events\n___________________________________\nSignificance level = 0.05\nNull hypothesis: OR = 1, RR = 1, RD = 0\np-value (two-sided):\n  0.012 based on Fisher's exact test\n  0.014 based on chi-squared test\n  0.012 based on odds ratio\n  0.012 based on relative risk\n  0.012 based on risk difference\n___________________________________\nFragility index (FI) and fragility quotient (FQ):\nBased on Fisher's exact test, FI = 8 (FQ = 0.1%)\n  for significance altered to non-significance,\n  achieved by inversing status of\n  8 non-events in group 0\nBased on chi-squared test, FI = 8 (FQ = 0.1%)\n  for significance altered to non-significance,\n  achieved by inversing status of\n  8 non-events in group 0; or\n  8 events in group 1; or\n  1 non-event in group 0 and 7 events in group 1; or\n  2 non-events in group 0 and 6 events in group 1; or\n  3 non-events in group 0 and 5 events in group 1; or\n  4 non-events in group 0 and 4 events in group 1; or\n  5 non-events in group 0 and 3 events in group 1; or\n  6 non-events in group 0 and 2 events in group 1; or\n  7 non-events in group 0 and 1 event in group 1\nBased on odds ratio, FI = 8 (FQ = 0.1%)\n  for significance altered to non-significance,\n  achieved by inversing status of\n  8 non-events in group 0\nBased on relative risk, FI = 8 (FQ = 0.1%)\n  for significance altered to non-significance,\n  achieved by inversing status of\n  8 non-events in group 0\nBased on risk difference, FI = 9 (FQ = 0.2%)\n  for significance altered to non-significance,\n  achieved by inversing status of\n  9 non-events in group 0; or\n  1 non-event in group 0 and 8 events in group 1; or\n  2 non-events in group 0 and 7 events in group 1; or\n  3 non-events in group 0 and 6 events in group 1; or\n  4 non-events in group 0 and 5 events in group 1; or\n  5 non-events in group 0 and 4 events in group 1; or\n  6 non-events in group 0 and 3 events in group 1; or\n  7 non-events in group 0 and 2 events in group 1; or\n  8 non-events in group 0 and 1 event in group 1\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"For the statistically in significant result of no CV death  in colchicine group\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nFor the statistically in significant result of no CV death  in colchicine group\n```\n\n\n:::\n\n```{.r .cell-code}\nfrag.study(e0 = 53, n0 = 2762, e1 = 35, n1 = 2760)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n___________________________________\nOriginal data:\n        event no event\ngroup 0    53     2709\ngroup 1    35     2725\nRange of event modification in group 0:\n  up to 53 events modified to be non-events;\n  up to 2709 non-events modified to be events\nRange of event modification in group 1:\n  up to 35 events modified to be non-events;\n  up to 2725 non-events modified to be events\n___________________________________\nSignificance level = 0.05\nNull hypothesis: OR = 1, RR = 1, RD = 0\np-value (two-sided):\n  0.067 based on Fisher's exact test\n  0.068 based on chi-squared test\n  0.055 based on odds ratio\n  0.055 based on relative risk\n  0.053 based on risk difference\n___________________________________\nFragility index (FI) and fragility quotient (FQ):\nBased on Fisher's exact test, FI = 2 (FQ = 0.0%)\n  for non-significance altered to significance,\n  achieved by inversing status of\n  2 non-events in group 0; or\n  2 events in group 1; or\n  1 non-event in group 0 and 1 event in group 1\nBased on chi-squared test, FI = 2 (FQ = 0.0%)\n  for non-significance altered to significance,\n  achieved by inversing status of\n  2 non-events in group 0; or\n  2 events in group 1; or\n  1 non-event in group 0 and 1 event in group 1\nBased on odds ratio, FI = 1 (FQ = 0.0%)\n  for non-significance altered to significance,\n  achieved by inversing status of\n  1 non-event in group 0; or\n  1 event in group 1\nBased on relative risk, FI = 1 (FQ = 0.0%)\n  for non-significance altered to significance,\n  achieved by inversing status of\n  1 non-event in group 0; or\n  1 event in group 1\nBased on risk difference, FI = 1 (FQ = 0.0%)\n  for non-significance altered to significance,\n  achieved by inversing status of\n  1 non-event in group 0; or\n  1 event in group 1\n```\n\n\n:::\n:::\n\n\n\nThis trial recruited patients from 2 countries and was analyzed by ignoring any regional differences. However it may be of interest to analyze this data taking into account any between region variability. This seems appropriate if one wants to eventually estimate the likely result if the study was repeated in a third country.   \n\n## The data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncountry <- data.frame(study = c(\"Australia\", \"Netherlands\"))\ncountry$d0 <- c(147,117)\ncountry$n0 <- c(953, 1807)\ncountry$d1 <- c(78,109)\ncountry$n1 <- c(951,1807)\n\n## @knitr relative_risk\ncountry$p1 <- country$d1/country$n1\ncountry$p0 <- country$d0/country$n0\ncountry$rr <- country$p1/country$p0\ncountry$lrr <- log(country$rr)\ncountry$lse <- sqrt((1 - country$p1)/(country$p1 * country$n1) + (1 - country$p0)/(country$p0 * country$n0))\ncountry$lower <- exp(country$lrr - qnorm(.975) * country$lse)\ncountry$upper <- exp(country$lrr + qnorm(.975) * country$lse)\n\n## @knitr forest_plot\nlibrary(\"metafor\")\np <- forest.default(x = country$rr, ci.lb = country$lower, ci.ub = country$upper, \n       slab = paste(country$study), refline = 1)\ntext(min(p$xlim), .88 * max(p$ylim), \"Study \", pos = 4, font = 2)\ntext(max(p$xlim), .88 * max(p$ylim), \"Relative Risk [95% CI]\", pos = 2, font = 2)\n```\n\n::: {.cell-output-display}\n![](colchicine_old_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# combining countries back to get overall LoDoCo2 results\ncountry_comb <- country[1,2:5] + country[2,2:5]\ncountry_comb$p1 <- country_comb$d1/country_comb$n1\ncountry_comb$p0 <- country_comb$d0/country_comb$n0\ncountry_comb$rr <- country_comb$p1/country_comb$p0\ncountry_comb$lrr <- log(country_comb$rr)\ncountry_comb$lse <- sqrt((1 - country_comb$p1)/(country_comb$p1 * country_comb$n1) + (1 - country_comb$p0)/(country_comb$p0 * country_comb$n0))\ncountry_comb$lower <- exp(country_comb$lrr - qnorm(.975) * country_comb$lse)\ncountry_comb$upper <- exp(country_comb$lrr + qnorm(.975) * country_comb$lse)\ncountry_comb$study <- c(\"LoDoCo2\")\ncountry_comb <-  country_comb[,c(12,1:11)]\n```\n:::\n\n\n\nThe relevant statistic for the meta-analysis is the relative risk ratio, $p_{1j} / p_{0j}$. We work with the log of the relative risk ratio, $y_j = log(p_{1j}) - log(p_{0j})$ with variance of each term calculated by the *delta* method as follows;    \n\n$$sigma^2_j \\approx \\frac{1 - p_{1j}}{n_{1j}p_{1j}} + \\frac{1 - p_{0j}}{n_{0j}p_{0j}}$$\n\n## Hierarchical model \n### Frequentist approach Fig 4A\nThe results from the separate RCTs can be modeled using a hierarchical model. We use the fact that the log of the relative risk is approximately normally distributed and assume that the random effects follow a normal distribution,    \n$$y_j \\sim N(\\theta_j, \\sigma^2_j)$$  \nA hierarchical model applied to meta-analysis is typically referred to as a random-effect meta-analysis model in the medical literature. The parameters of the hierarchical model can be estimated in either a frequentist or a Bayesian framework. In a frequentist setup, point estimates (rather than probability distributions) for the parameters are estimated. \n$$\\theta_j \\sim N(\\mu, \\tau)$$   \nThere are, in general, three ways to estimate the random effects, $\\theta_j$  \n* no pooling, each study is separate $\\tau = \\infty$   \n* completing pooling all $\\theta_j$ are from a common distribution, so essentially $\\tau = 0$ - this is also known as fixed-effect meta-analysis model completely pools the relative risk estimates across studies. The overall mean is commonly estimated by taking an inverse-variance weighted average of studies.   \n* partial pooling,  the hierarchical model is a compromise between the no-pooling and the complete-pooling estimates. The parameters of the hierarchical model can be estimated in either a frequentist or a Bayesian framework. In a frequentist setup, point estimates (rather than probability distributions) for the parameters are estimated. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(meta)\n# no pooling - only LoDoCO trial\nme.fe <- rma(country$lrr, country$lse^2, method = \"FE\")\ncat(\"Completely pooled results with the point estimate followed by the 95%CI\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCompletely pooled results with the point estimate followed by the 95%CI\n```\n\n\n:::\n\n```{.r .cell-code}\nc(exp(me.fe$b), exp(me.fe$ci.lb), exp(me.fe$ci.ub))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.7090940 0.5916936 0.8497882\n```\n\n\n:::\n\n```{.r .cell-code}\n#check to see that the point estimate is identical to taking a weighted average of the relative risks in the RCTs\n#exp(weighted.mean(country$lrr, 1/(country$lse^2)))\n\n# frequentist random effects\nme.re <- rma(country$lrr, country$lse^2)\ncat(\"Hierarchical or random effects with the point estimate \", exp(me.re$b), \"followed by the 95%CI \",c(exp(me.re$ci.lb), exp(me.re$ci.ub)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nHierarchical or random effects with the point estimate  0.7043957 followed by the 95%CI  0.4065763 1.220369\n```\n\n\n:::\n\n```{.r .cell-code}\nm1 <- meta::metabin(country$d1, country$n1, country$d0, country$n0, sm=\"RR\", method =\"I\", \n                    studlab=country$study, prediction=TRUE) #, comb.random =TRUE\nmeta::forest(m1)\n```\n\n::: {.cell-output-display}\n![](colchicine_old_files/figure-html/unnamed-chunk-3-1.png){width=960}\n:::\n\n```{.r .cell-code}\npdf(file = 'output/col_4A.pdf', width = 12) \nmeta::forest(m1)                    \ndev.off()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nquartz_off_screen \n                2 \n```\n\n\n:::\n\n```{.r .cell-code}\npng(file = 'output/col_4A.png', width = 4480,  height = 1000, res = 300) \nmeta::forest(m1)\ndev.off() \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nquartz_off_screen \n                2 \n```\n\n\n:::\n\n```{.r .cell-code}\n# backup image col_ma_fe_re_freq.png (but not sure how this was saved)\n\ncat(\"Hierarchical mean =\", exp(m1$TE.random), \"with SD of \", m1$seTE.random, \"and 95% CI \", c(exp(m1$lower.random),\nexp(m1$upper.random)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nHierarchical mean = 0.7043957 with SD of  0.2803973 and 95% CI  0.4065763 1.220369\n```\n\n\n:::\n\n```{.r .cell-code}\nmy.func1(my_sd=0.28,my_mean=log(0.7047))\n```\n\n::: {.cell-output-display}\n![](colchicine_old_files/figure-html/unnamed-chunk-3-2.png){width=960}\n:::\n:::\n\n\nThe bottom line appears that if one employs a model that captures the variability between different populations, it can be seen that while the point estimate suggests a benefit of colchicine in chronic CAD but the further studies are required to narrow our uncertainty. This is especially true since the outcome was a composite one largely driven by non-fatal outcomes   \nIf one wants to adopt a bayesian approach we could incorporate previous RCT (COLCT) in a similar CAD population to refine this estimate while awaiting further studies.\n\n### Bayesian approach - vaguely informative prior Fig 4B\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(MetaStan)\ncountry <- country %>% \n  mutate(y0 = n0 - d0, y1 = n1 - d1)\ndat_MetaStan <- create_MetaStan_dat(dat = country,\n                        armVars = c(responders = \"y\", sampleSize = \"n\"))\n\nLoDoCo.stan <- meta_stan(data = dat_MetaStan,\n                         likelihood = \"binomial\",\n                         tau_prior_dist = \"half-normal\",\n                         tau_prior = 0.5,\n                         theta_prior = c(0, 2.82),\n                         model = \"BNHM1\",\n                         chains = 4,\n                         iter = 2000,\n                         adapt_delta = .99,\n                         warmup = 1000)\n\nprint(LoDoCo.stan)\nprint(\"Using MetaStan package\")\ncat(\"The Bayesian hierarchical random effects with vaguely informative prior is \", round(exp(LoDoCo.stan$fit_sum[3,1]),2), \" with 95% CI \", round(exp(LoDoCo.stan$fit_sum[3,4]),2), \" - \", round(exp(LoDoCo.stan$fit_sum[3,8]),2))\n\n#MetaStan has no plot functions so need to use the following\nlibrary(ggplot2)\n# Functions to calculate log odds ratios and variances from data\nlogodds <- function(x) log((x[1] * (x[4] - x[3]))/((x[2] - x[1]) * x[3]))\nstdes   <- function(x) sqrt(1/x[1] + 1/(x[2] - x[1]) + 1/x[3] + 1/(x[4] - x[3]))\nr_ind   <- apply(cbind(country$d1, country$n1, \n                       country$d0, country$n0), 1, logodds)\nse_ind  <- apply(cbind(country$d1, country$n1, \n                       country$d0, country$n0), 1, stdes)\nlower95_ind <- r_ind + qnorm(.025) * se_ind\nupper95_ind <- r_ind + qnorm(.975) * se_ind\n# Comparison of the results\ntrials  <- c(\"Australia\", \"Netherlands\")\n# trials <- ordered(trials, levels = trials)\n\nd <- data.frame(x = trials,\n                y = r_ind,\n                ylo = lower95_ind,\n                yhi = upper95_ind)  # reverse line order if needed %>% map_df(rev)\n\nd$x <- factor(d$x, levels=rev(d$x)) # to get right order for plot lines\n\nforest.plot <- ggplot(d, aes(x = x, y = y, ymin = ylo, ymax = yhi)) +\n  geom_pointrange() +\n  coord_flip() +\n  geom_hline(aes(yintercept=0), lty = 2) +\n  labs(x = \"Studies\", y =\"OR\") +\n  ggtitle(\"Forest Plot LoDoCo2 by participating countries\") +\n  theme_classic()\n\nplot(forest.plot)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# bayesmeta package\nrequire(\"bayesmeta\")\neffsize <- escalc(measure=\"OR\",\n                  ai=d1, n1i=n1,\n                  ci=d0, n2i=n0,\n                  slab=study, data=country)\n# perform meta-analysis:\nbma <- bayesmeta(effsize, tau.prior = function(t){dhalfnormal(t, scale=0.5)})\n# show results:\nprint(bma)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n 'bayesmeta' object.\n\n2 estimates:\nAustralia, Netherlands\n\ntau prior (proper):\nfunction (t) \n{\n    dhalfnormal(t, scale = 0.5)\n}\n<bytecode: 0x148c555b8>\n\nmu prior (improper):\nuniform(min=-Inf, max=Inf)\n\nML and MAP estimates:\n                   tau         mu\nML joint     0.2851187 -0.3896994\nML marginal  0.4278871 -0.3850185\nMAP joint    0.2573867 -0.3888331\nMAP marginal 0.3353293 -0.3849811\n\nmarginal posterior summary:\n                 tau         mu\nmode      0.33532933 -0.3849811\nmedian    0.43523853 -0.3892617\nmean      0.48100241 -0.3909552\nsd        0.25210359  0.3976179\n95% lower 0.07366192 -1.2197295\n95% upper 1.00115690  0.4336555\n\n(quoted intervals are shortest credible intervals.)\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(\"Using bayesmeta package\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Using bayesmeta package\"\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"The Bayesian hierarchical random effects with vaguely informative prior is \", round(exp(bma$summary[3,2]),2), \" with 95% CI \", \n    round(exp(bma$summary[5,2]),2), \n    \" - \", round(exp(bma$summary[6,2]),2))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nThe Bayesian hierarchical random effects with vaguely informative prior is  0.68  with 95% CI  0.3  -  1.54\n```\n\n\n:::\n\n```{.r .cell-code}\n# show forest plot:\nforestplot(bma)\n```\n\n::: {.cell-output-display}\n![](colchicine_old_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\npng(file = 'output/col_4B.png', width = 4480,  height = 1000, res = 300) \nforestplot(bma)\ndev.off() \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nquartz_off_screen \n                2 \n```\n\n\n:::\n:::\n\n\n\n\n### Figure 4C \n\n\n::: {.cell}\n\n```{.r .cell-code}\n#getting probabilitiies for figure\n\npnorm(-.1625,bma$summary[3,2], bma$summary[4,2])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.7172054\n```\n\n\n:::\n\n```{.r .cell-code}\npnorm(0,bma$summary[3,2], bma$summary[4,2])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.8372562\n```\n\n\n:::\n\n```{.r .cell-code}\n# PDF plot\n1-pnorm(0, bma$summary[3,2], bma$summary[4,2])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.1627438\n```\n\n\n:::\n\n```{.r .cell-code}\nlodoco_pdf <- ggplot(data.frame(x = c(-2, 1)), aes(x = x)) +\n  stat_function(fun = dnorm, args = list(bma$summary[3,2], bma$summary[4,2]),  colour = \"orange\", size=2) +\n  scale_x_continuous(name = \"Log relative risk\") +\n  scale_y_continuous(name = \"Density\") +\n  labs(title=\"LoDoCO2 PDF of log(relative risk) for primary outcome - \",\n       subtitle = \"Non-informative mean prior and vaguely informative heterogeneity prior\", caption=\"AUC = area under the curve\\n     PDF = probability density function\") +\n  geom_vline(xintercept=mean(bma$summary[3,2])) +\n  annotate(\"text\", label = \"Black vertical line =\\nmean log(relative risk) (-0.39)\\nwith colchicine\", x = -1.8, y = .85, color = \"black\", hjust=0) +\n  annotate(\"text\", label = \"Grey AUC = probability (71%)\\n of at least 15% decrease\\n in relative risk\\n  with colchicine\", x = -2, y = .4, color = \"black\", hjust=0) +\n  annotate(\"text\", label = \"Grey + Yellow AUC =\\nprobability (84%)\\ndecrease in relative risk\\nyellow area (13%) =\\nregion of practical equivalence\", x = 0, y = .85, color = \"black\", hjust=0) +\n  theme_classic() +\n  stat_function(fun = dnorm, args = list(bma$summary[3,2], bma$summary[4,2]), xlim = c(-2,-.1625), geom = \"area\", fill= \"gray\",alpha = 0.2) +\n  stat_function(fun = dnorm, args = list(bma$summary[3,2], bma$summary[4,2]), xlim = c(-.1625, 0), geom = \"area\", fill= \"yellow\",alpha = 0.2) \n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n```\n\n\n:::\n\n```{.r .cell-code}\nlodoco_pdf\n```\n\n::: {.cell-output-display}\n![](colchicine_old_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\npdf(\"output/lodoco_pdf.pdf\")\nlodoco_pdf\ndev.off()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nquartz_off_screen \n                2 \n```\n\n\n:::\n\n```{.r .cell-code}\nggsave(\"output/col_4C.png\", dpi = 300)  #lodoco_pdf.png is backup image\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nSaving 7 x 5 in image\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# uses shiny to verify model\nlibrary(\"shinystan\")\n## Firstly convert \"stan\" object to a \"shinystan\" object\nLoDoCo.shinystan = as.shinystan(LoDoCo.stan$fit)\nlaunch_shinystan(LoDoCo.shinystan)\n```\n:::\n\n\n\n##  Hierarchical (random effects) - frequentist approach adding another study \nA similar randomized, double-blind trial comparing colchicine to placebo but involving patients recruited within 30 days after a myocardial infarction (COLCOT)  was published in the [NEJM](https://www.nejm.org/doi/10.1056/NEJMoa1912388?url_ver=Z39.88-2003&rfr_id=ori:rid:crossref.org&rfr_dat=cr_pub%20%200pubmed) and this can be included in a (frequentist) random effects meta-analysis. This study reports a total of 4745 patients were enrolled; 2366 patients were assigned to the colchicine\ngroup, and 2379 to the placebo group. Patients were followed for a median of 22.6\nmonths. The primary end point occurred in 5.5% of the patients in the colchicine\ngroup, as compared with 7.1% of those in the placebo group (hazard ratio, 0.77; 95%\nconfidence interval [CI], 0.61 to 0.96; P = 0.02).  \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# combined prior data (COLCOT) with current data from LodoCo as from hierarchical analysis\nprior <- data.frame(study = c(\"COLCOT\"))\nprior$d0 <- 170\nprior$n0 <- 2379\nprior$d1 <- 131\nprior$n1 <- 2366\n\n## @knitr relative_risk\nprior$p1 <- prior$d1/prior$n1\nprior$p0 <- prior$d0/prior$n0\nprior$rr <- prior$p1/prior$p0\nprior$lrr <- log(prior$rr)\nprior$lse <- sqrt((1 - prior$p1)/(prior$p1 * prior$n1) + (1 - prior$p0)/(prior$p0 * prior$n0))\nprior$lower <- exp(prior$lrr - qnorm(.975) * prior$lse)\nprior$upper <- exp(prior$lrr + qnorm(.975) * prior$lse)\n\ncomb <- rbind(country,prior)\nm2 <- meta::metabin(comb$d1, comb$n1, comb$d0, comb$n0, sm=\"RR\", method =\"I\", \n                    studlab=comb$study, prediction=TRUE) #, comb.random =TRUE\nmeta::forest(m2)\n```\n\n::: {.cell-output-display}\n![](colchicine_old_files/figure-html/unnamed-chunk-8-1.png){width=960}\n:::\n\n```{.r .cell-code}\n# use only 1/2 COLCOT data\nprior2 <- prior[,2:5]/2\nprior2$study <- c(\"COLCOT\")\nprior2$p1 <- prior2$d1/prior2$n1\nprior2$p0 <- prior2$d0/prior2$n0\nprior2$rr <- prior2$p1/prior2$p0\nprior2$lrr <- log(prior2$rr)\nprior2$lse <- sqrt((1 - prior2$p1)/(prior2$p1 * prior2$n1) + (1 - prior2$p0)/(prior2$p0 * prior2$n0))\nprior2$lower <- exp(prior2$lrr - qnorm(.975) * prior2$lse)\nprior2$upper <- exp(prior2$lrr + qnorm(.975) * prior2$lse)\n\ncomb2 <- rbind(country,prior2)\nm3 <- meta::metabin(comb2$d1, comb2$n1, comb2$d0, comb2$n0, sm=\"RR\", method =\"I\", \n                    studlab=comb2$study, prediction=TRUE) #, comb.random =TRUE\nmeta::forest(m3)\n```\n\n::: {.cell-output-display}\n![](colchicine_old_files/figure-html/unnamed-chunk-8-2.png){width=960}\n:::\n:::\n\n\n\nThis first forest plot may be seen as the most optimistic  as the COLCOT data is presented as a pooled results which ignores all between country (12) variations within this trial.   \nAccounting for within study variation between centers in different countries, can assume that the COLCOT point estimate stays unchanged but the increased variability could be presented by considering only 1/2 the sample size, leading to the second forest plot.\n\n\n## Bayesian Approach\n\nThe COLCOT trial may provide a prior distribution for a Bayesian analysis.   \nHowever as mentioned previously, this study also ignores regional difference among the 12 participating countries. Therefore a reasonable prior might be centered at COLCOT point estimate but with increased variation is that there is have an approximately 10% probability of RR > 0, similar to the random effects result from  LoDoCo2. This is attained with a distribution with$\\mu$ $\\approx$ 0.8 with $\\sigma$ $\\approx$ .2.  \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy.func1(my_sd=0.2,my_mean=log(0.80),prob_harm=TRUE,upper_limit=2.5)\n```\n\n::: {.cell-output-display}\n![](colchicine_old_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n### Triplot with my analytical function - Figure 5\n\nThe triplots here use   \n- Mean and sd from the LoDoCo2 hierarchical estimate    \n- Priors based on COLCOT with $\\mu$ = 0.77 and $\\sigma$ = 0.2     \n- This prior seems reasonable as this gives about 10% probability of increased risk similar ot what was seen with hierarchical model of LoDoCo2     \n- Posterior mean and sd calculated analytically via `post` function (defined in 1st code chunk)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanalytical <- post(exp(m1$TE.random), m1$seTE.random, .77, .2)\n# pnorm(0, log(analytical[[1]]), analytical[[2]])\n# pnorm(-.1625, log(analytical[[1]]), analytical[[2]]) 15% reduction = log(.85)\n\n\n# same graph different formatting - good for paper\n\ncol_tri <- ggplot(data = data.frame(x = c(-1.25, .5)), aes(x)) +\n  stat_function(fun = dnorm, args = list(bma$summary[3,2], bma$summary[4,2]),  colour = \"yellow\", size=1) +\n  stat_function(fun = dnorm, n = 1000, args = list(mean = log(.77), sd = .2), size=1, color = \"red\") + \n  stat_function(fun = dnorm, n = 1000, args = list(log(analytical[[1]]), analytical[[2]]), color = \"orange\", size=2)  +\n  scale_x_continuous(name = \"Log RR (Colchicine / Placebo) for composite outcome\") +\n  scale_y_continuous(name = \"Density\") +\n  ggtitle(\"Colchicine - Triplot probabilities for composite primary outcome\")  +\n  labs(x = \"Log (RR)\", caption = \"Probability density curves assumed normal distributions\", subtitle = \"Analytical solution from log normal prior (N(-0.261, 0.2)) & log normal likelihood (N(-0.391, 0.398))\") +\n  annotate(\"text\", size=3, label = \"Orange = Posterior (Combined data) \\nYellow = Likelihood (LoDoCo2 trial) \\nRed = Prior distribution(COLCOT trial)\", x = -1.15, y = 1.25, hjust = 0, color = \"black\") +\n  annotate(\"text\", size=3, label = \"Area under orange curve (AUC)\\n to the left of the dashed line\\n at x=0 (orange + grey area) is the \\nprobability that colchicine decreases\\n composite outcome = 92%\\nAUC to left of solid line (grey area)\\n is probability that colchicine\\n decreases composite outcome\\n by at least 15% = 75%\", x = 0, y = 1.35, hjust = 0, color = \"black\") +\n  geom_segment(aes(x = 0, y = 0, xend = 0, yend = 2.2), linetype=\"dashed\",  size=.5) +\n  geom_segment(aes(x = -.1625, y = 0, xend = -.1625, yend = 2.2), linetype=\"solid\",  size=.5) +\n  theme_classic()  +\n  stat_function(fun = dnorm, args = list(log(analytical[[1]]), analytical[[2]]), xlim = c(-1.25,-.1625), geom = \"area\", fill= \"gray\",alpha = 0.2) +\n  stat_function(fun = dnorm, args = list(log(analytical[[1]]), analytical[[2]]), xlim = c(-.1625, 0), geom = \"area\", fill= \"orange\",alpha = 0.2) \n\n\ncol_tri\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning in geom_segment(aes(x = 0, y = 0, xend = 0, yend = 2.2), linetype = \"dashed\", : All aesthetics have length 1, but the data has 2 rows.\nℹ Please consider using `annotate()` or provide this layer with data containing\n  a single row.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning in geom_segment(aes(x = -0.1625, y = 0, xend = -0.1625, yend = 2.2), : All aesthetics have length 1, but the data has 2 rows.\nℹ Please consider using `annotate()` or provide this layer with data containing\n  a single row.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](colchicine_old_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n\n```{.r .cell-code}\npdf(\"output/col_tri_fig5.pdf\")\ncol_tri\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning in geom_segment(aes(x = 0, y = 0, xend = 0, yend = 2.2), linetype = \"dashed\", : All aesthetics have length 1, but the data has 2 rows.\nℹ Please consider using `annotate()` or provide this layer with data containing\n  a single row.\nAll aesthetics have length 1, but the data has 2 rows.\nℹ Please consider using `annotate()` or provide this layer with data containing\n  a single row.\n```\n\n\n:::\n\n```{.r .cell-code}\ndev.off()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nquartz_off_screen \n                2 \n```\n\n\n:::\n\n```{.r .cell-code}\nggsave(\"output/col_tri_fig5.png\", dpi = 300, height = 4, width = 8)  \n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning in geom_segment(aes(x = 0, y = 0, xend = 0, yend = 2.2), linetype = \"dashed\", : All aesthetics have length 1, but the data has 2 rows.\nℹ Please consider using `annotate()` or provide this layer with data containing\n  a single row.\nAll aesthetics have length 1, but the data has 2 rows.\nℹ Please consider using `annotate()` or provide this layer with data containing\n  a single row.\n```\n\n\n:::\n:::\n\n\n### Robustnees test with increased COLOCT variability\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# different prior increased variation\nanalytical <- post(exp(m1$TE.random), m1$seTE.random, .77, .4)\n# pnorm(0, log(analytical[[1]]), analytical[[2]])\n# pnorm(-.1625, log(analytical[[1]]), analytical[[2]]) 15% reduction = log(.85)\n# 1- pnorm(0, log(.77), .3)\n\ng_an_2 <- ggplot(data = data.frame(x = c(-1.25, .5)), aes(x)) +\n  stat_function(fun = dnorm, args = list(bma$summary[3,2], bma$summary[4,2]),  colour = \"yellow\", size=1) +\n  stat_function(fun = dnorm, n = 1000, args = list(mean = log(.77), sd = .4), size=1, color = \"red\") + \n  stat_function(fun = dnorm, n = 1000, args = list(log(analytical[[1]]), analytical[[2]]), color = \"orange\", size=2)  +\n  scale_x_continuous(name = \"Log RR (Colchicine / Placebo) for composite outcome\") +\n  scale_y_continuous(name = \"Density\") +\n  ggtitle(\"Colchicine - Triplot probabilities for composite primary outcome\")  +\n  labs(x = \"Log (RR)\", caption = \"Probability density curves assumed normal distributions\", subtitle = \"Analytical solution from normal prior & normal likelihood\") +\n  annotate(\"text\", size=3, label = \"Orange = Posterior (Combined data) \\nYellow = Likelihood (LoDoCo2 trial) \\nRed = Prior distribution(COLCOT trial)\", x = -1.15, y = 1.25, hjust = 0, color = \"black\") +\n  annotate(\"text\", size=3, label = \"Area under orange curve (AUC)\\n to the left of the dashed line\\n at x=0 (orange + grey area) is the \\nprobability that colchicine decreases\\n composite outcome = 93%\\nAUC to left of solid line (grey area)\\n is probability that colchicine\\n decreases composite outcome\\n by at least 15% = 76%\", x = 0, y = 1.35, hjust = 0, color = \"black\") +\n  geom_segment(aes(x = 0, y = 0, xend = 0, yend = 2.2), linetype=\"dashed\",  size=.5) +\n  geom_segment(aes(x = -.1625, y = 0, xend = -.1625, yend = 2.2), linetype=\"solid\",  size=.5) +\n  theme_classic()  +\n  stat_function(fun = dnorm, args = list(log(analytical[[1]]), analytical[[2]]), xlim = c(-1.25,-.1625), geom = \"area\", fill= \"gray\",alpha = 0.2) +\n  stat_function(fun = dnorm, args = list(log(analytical[[1]]), analytical[[2]]), xlim = c(-.1625, 0), geom = \"area\", fill= \"orange\",alpha = 0.2) \n\ng_an_2\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning in geom_segment(aes(x = 0, y = 0, xend = 0, yend = 2.2), linetype = \"dashed\", : All aesthetics have length 1, but the data has 2 rows.\nℹ Please consider using `annotate()` or provide this layer with data containing\n  a single row.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning in geom_segment(aes(x = -0.1625, y = 0, xend = -0.1625, yend = 2.2), : All aesthetics have length 1, but the data has 2 rows.\nℹ Please consider using `annotate()` or provide this layer with data containing\n  a single row.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](colchicine_old_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n\n```{.r .cell-code}\npdf(\"output/g_an_2.pdf\")\ng_an_2\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning in geom_segment(aes(x = 0, y = 0, xend = 0, yend = 2.2), linetype = \"dashed\", : All aesthetics have length 1, but the data has 2 rows.\nℹ Please consider using `annotate()` or provide this layer with data containing\n  a single row.\nAll aesthetics have length 1, but the data has 2 rows.\nℹ Please consider using `annotate()` or provide this layer with data containing\n  a single row.\n```\n\n\n:::\n\n```{.r .cell-code}\ndev.off()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nquartz_off_screen \n                2 \n```\n\n\n:::\n\n```{.r .cell-code}\nggsave(\"output/g_an_2.png\")  \n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nSaving 7 x 5 in image\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning in geom_segment(aes(x = 0, y = 0, xend = 0, yend = 2.2), linetype = \"dashed\", : All aesthetics have length 1, but the data has 2 rows.\nℹ Please consider using `annotate()` or provide this layer with data containing\n  a single row.\nAll aesthetics have length 1, but the data has 2 rows.\nℹ Please consider using `annotate()` or provide this layer with data containing\n  a single row.\n```\n\n\n:::\n:::\n\n\n\n\n### Triplot using `bayesmeta` package\nA wide range of problems may be approached using the normal-normal hierarchical model (NNHM); a generic random-effects model that can be operationalized using the `bayesmeta` package. For random-effects meta-analysis within the NNHM, where only two unkown parameters are to be inferred, computations may be simplified by utilizing numerical integration or importance resampling, without need for MCMC techniques.    \n- here the posterior mean and sd are calculated from the `bayesmeta` function  \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Total data\n# Use a vague prior centered at 0, which corresponds to an OR of 1, i.e., no effect. \n# The prior standard deviation has been assumed to be a half-normal prior with scale 0.03\n# posterior\n# pnorm(0, comb1.mean, comb1.sd)\n# pnorm(-.1625, comb1.mean, comb1.sd) 15% reduction = log(.85)\n# pnorm(0, comb2.mean, comb2.sd)\n# pnorm(-.1625, comb2.mean, comb2.sd) 15% reduction = log(.85)\n\n\n\nma_tot1 <- bayesmeta(y = comb[,\"lrr\"], sigma = comb[,\"lse\"],\n                  labels = comb[,\"study\"], mu.prior.mean = 0, mu.prior.sd = 2,\n                  tau.prior = function(t){dhalfnormal(t,scale=0.03)})\n\n\ncomb1.mean <- ma_tot1$summary[3,2] \ncomb1.sd <-  ma_tot1$summary[4,2] \nma_tot1$summary\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                 tau          mu       theta\nmode      0.00000000 -0.30827020 -0.30814562\nmedian    0.02431826 -0.30834327 -0.30827951\nmean      0.02826351 -0.30837968 -0.30837968\nsd        0.02076202  0.07416835  0.08191583\n95% lower 0.00000000 -0.45386385 -0.46980250\n95% upper 0.06789900 -0.16290239 -0.14705266\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(ma_tot1)\n```\n\n::: {.cell-output-display}\n![](colchicine_old_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](colchicine_old_files/figure-html/unnamed-chunk-12-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](colchicine_old_files/figure-html/unnamed-chunk-12-3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](colchicine_old_files/figure-html/unnamed-chunk-12-4.png){width=672}\n:::\n\n```{.r .cell-code}\n#1/2 data prior\n\nma_tot2 <- bayesmeta(y = comb2[,\"lrr\"], sigma = comb2[,\"lse\"],\n                  labels = comb2[,\"study\"], mu.prior.mean = 0, mu.prior.sd = 2,\n                  tau.prior = function(t){dhalfnormal(t,scale=0.03)})\n\n\ncomb2.mean <- ma_tot2$summary[3,2] \ncomb2.sd <-  ma_tot2$summary[4,2] \n\n#graphs\n\ng_bayes1 <- ggplot(data = data.frame(x = c(-1.25, .5)), aes(x)) +\n  stat_function(fun = dnorm, n = 1000, args = list(mean = log(.77), sd = .2), geom = \"area\", color = \"steelblue\", fill = \"steelblue\", alpha=.1) + \n  stat_function(fun = dnorm, n = 1000, args = list(mean = m1$TE.random, sd = m1$seTE.random), geom = \"area\", color = \"yellow\", fill = \"yellow\", alpha=.1, xlim = c(-1.25,.5)) + \n  stat_function(fun = dnorm, n = 1000, args = list(comb1.mean,comb1.sd), , geom = \"area\", color = \"red\",\n                fill = \"red\", alpha=.1, xlim = c(-1.25,.5))  +\n    scale_x_continuous(name = \"Log RR (Colchicine / Placebo) for composite outcome\") +\n    scale_y_continuous(name = \"Density\") +\n    ggtitle(\"Colchicine - all trial data\")  +\n    labs(x = \"Log (RR)\", caption = \"Probability density for individual trials \\nbased on vaguely informative priors  \", subtitle = \"Using bayesmeta function\") +\n  annotate(\"text\", size=3, label = \"Red = Combined data \\nYellow = LoDoCo2 trial \\nBlue = COLCOT trial\", x = -.85, y = 2, hjust = 0, color = \"black\") +\n  annotate(\"text\", size=3, label = \"Area under red curve (AUC) to the left\\n of the dashed line at x=0 is the \\nprobability that colchicine decreases\\n composite outcome = 99.9%\\nAUC to left of solid line is probability\\nthat colchicine decreases composite\\n outcome by at least 15% = 97%\", x = 0, y = 2.5, hjust = 0, color = \"black\") +\n  geom_segment(aes(x = 0, y = 0, xend = 0, yend = 4), linetype=\"dashed\", color = \"light gray\", size=.5) +\n  geom_segment(aes(x = -.1625, y = 0, xend = -.1625, yend = 4), linetype=\"solid\", color = \"light gray\", size=.5) +\n    theme_classic()\n\ng_bayes1\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning in geom_segment(aes(x = 0, y = 0, xend = 0, yend = 4), linetype = \"dashed\", : All aesthetics have length 1, but the data has 2 rows.\nℹ Please consider using `annotate()` or provide this layer with data containing\n  a single row.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning in geom_segment(aes(x = -0.1625, y = 0, xend = -0.1625, yend = 4), : All aesthetics have length 1, but the data has 2 rows.\nℹ Please consider using `annotate()` or provide this layer with data containing\n  a single row.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](colchicine_old_files/figure-html/unnamed-chunk-12-5.png){width=672}\n:::\n\n```{.r .cell-code}\n#1/2 prior\n\ng_bayes2 <- ggplot(data = data.frame(x = c(-1.25, .5)), aes(x)) +\n  stat_function(fun = dnorm, n = 1000, args = list(mean = log(.77), sd = .3), geom = \"area\", color = \"steelblue\", fill = \"steelblue\", alpha=.1) + \n  stat_function(fun = dnorm, n = 1000, args = list(mean = m1$TE.random, sd = m1$seTE.random), geom = \"area\", color = \"yellow\", fill = \"yellow\", alpha=.1, xlim = c(-1.25,.5)) + \n  stat_function(fun = dnorm, n = 1000, args = list(comb2.mean,comb2.sd), , geom = \"area\", color = \"red\",\n                fill = \"red\", alpha=.1, xlim = c(-1.25,.5))  +\n    scale_x_continuous(name = \"Log RR (Colchicine / Placebo) for composite outcome\") +\n    scale_y_continuous(name = \"Density\") +\n    ggtitle(\"Colchicine - all trial data\")  +\n    labs(x = \"Log (RR)\", caption = \"Probability density for individual trials \\nbased on vaguely informative priors  \", subtitle = \"Using bayesmeta function\") +\n  annotate(\"text\", size=3, label = \"Red = Combined data \\nYellow = LoDoCo2 trial \\nBlue = COLCOT trial\", x = -.85, y = 2, hjust = 0, color = \"black\") +\n  annotate(\"text\", size=3, label = \"Area under red curve (AUC) to the left\\n of the dashed line at x=0 is the \\nprobability that colchicine decreases\\n composite outcome = 99.9%\\nAUC to left of solid line is probability\\nthat colchicine decreases composite\\n outcome by at least 15% = 97%\", x = 0, y = 2.5, hjust = 0, color = \"black\") +\n  geom_segment(aes(x = 0, y = 0, xend = 0, yend = 4), linetype=\"dashed\", color = \"light gray\", size=.5) +\n  geom_segment(aes(x = -.1625, y = 0, xend = -.1625, yend = 4), linetype=\"solid\", color = \"light gray\", size=.5) +\n    theme_classic()\n\ng_bayes2\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning in geom_segment(aes(x = 0, y = 0, xend = 0, yend = 4), linetype = \"dashed\", : All aesthetics have length 1, but the data has 2 rows.\nℹ Please consider using `annotate()` or provide this layer with data containing\n  a single row.\nAll aesthetics have length 1, but the data has 2 rows.\nℹ Please consider using `annotate()` or provide this layer with data containing\n  a single row.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](colchicine_old_files/figure-html/unnamed-chunk-12-6.png){width=672}\n:::\n:::\n",
    "supporting": [
      "colchicine_old_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}